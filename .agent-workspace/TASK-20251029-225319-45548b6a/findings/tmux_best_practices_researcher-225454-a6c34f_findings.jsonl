{"timestamp": "2025-10-29T23:02:39.402070", "agent_id": "tmux_best_practices_researcher-225454-a6c34f", "finding_type": "recommendation", "severity": "high", "message": "BEST PRACTICE: Use tmux kill-session for graceful termination. Sends SIGHUP to all processes allowing proper cleanup. NEVER use send-keys exit - it has timing issues and is unreliable.", "data": {"command": "tmux kill-session -t session_name", "signal": "SIGHUP", "avoid": "tmux send-keys -t session_name exit Enter", "reason": "send-keys has timing issues and simulates keystrokes unreliably"}}
{"timestamp": "2025-10-29T23:02:48.942700", "agent_id": "tmux_best_practices_researcher-225454-a6c34f", "finding_type": "solution", "severity": "medium", "message": "PYTHON INTEGRATION: libtmux library provides clean Pythonic API for tmux management. Recommended over subprocess for session lifecycle management, monitoring, and cleanup.", "data": {"library": "libtmux", "install": "pip install libtmux", "benefits": ["Clean API", "Session objects", "Proper error handling", "Better than subprocess"], "use_cases": ["Session creation", "Resource tracking", "Graceful cleanup", "Status monitoring"]}}
{"timestamp": "2025-10-29T23:02:59.412519", "agent_id": "tmux_best_practices_researcher-225454-a6c34f", "finding_type": "issue", "severity": "critical", "message": "FILE HANDLE LEAKS: Log files opened by tee or redirection remain open after session termination. Must explicitly close file handles. Use Python context managers (with open) or explicit close() calls.", "data": {"problem": "File handles not freed when tmux session killed", "bad_pattern": "subprocess.run(f\"command | tee {log_file}\", shell=True)", "good_pattern": "with open(log_file, \"w\") as f: subprocess.Popen(command, stdout=f).wait()", "verification": "lsof -p <tmux_pid> to check open files", "impact": "Each agent deployment leaks file handles, eventually hitting system limits"}}
{"timestamp": "2025-10-29T23:03:09.324973", "agent_id": "tmux_best_practices_researcher-225454-a6c34f", "finding_type": "solution", "severity": "high", "message": "AUTOMATED CLEANUP: Implement periodic cleanup script that detects completed/orphaned sessions and frees resources. Monitor session activity time and kill inactive sessions beyond threshold (e.g., 110 minutes).", "data": {"pattern": "Periodic background task checking session activity", "detection": "tmux list-sessions -F \"#{session_name}:#{session_activity}\"", "cleanup_trigger": "Inactivity threshold or session completion", "cleanup_actions": ["Close file handles", "Kill tmux session", "Remove temp files", "Update tracking"], "frequency": "Every 60 seconds recommended"}}
{"timestamp": "2025-10-29T23:03:20.246792", "agent_id": "tmux_best_practices_researcher-225454-a6c34f", "finding_type": "recommendation", "severity": "critical", "message": "COMPREHENSIVE CLEANUP NEEDED: kill_real_agent must do MORE than just kill tmux session. Required: (1) Close log file handles, (2) Cleanup progress/*.jsonl, (3) Cleanup findings/*.jsonl, (4) Remove temp prompt files, (5) THEN kill tmux session.", "data": {"current_behavior": "Only kills tmux session at line 3872", "required_steps": ["1. Close JSONL log file handles explicitly", "2. Delete progress/*.jsonl files", "3. Delete findings/*.jsonl files", "4. Delete agent_prompt_*.txt files", "5. Kill tmux session with SIGHUP", "6. Update agent registry", "7. Verify cleanup completed"], "implementation": "Use AgentSessionManager class pattern from TMUX_BEST_PRACTICES.md Section 8.2"}}
{"timestamp": "2025-10-29T23:03:31.101483", "agent_id": "tmux_best_practices_researcher-225454-a6c34f", "finding_type": "insight", "severity": "medium", "message": "ORPHAN DETECTION: Orphaned sessions show in tmux ls but have no active clients. Can be detected using tmux has-session check combined with activity timestamp comparison. Zombie panes show [dead] status with remain-on-exit option.", "data": {"detection_method": "tmux has-session -t <name> returns exit code 1 if session is dead", "activity_check": "tmux ls -F \"#{session_name}:#{session_activity}\" to get last activity timestamp", "orphan_indicators": ["Listed in tmux ls but has-session fails", "No pts number (shows ? instead)", "Very old activity timestamp"], "cleanup": "Safe to force kill orphaned sessions as no processes are actually running"}}
