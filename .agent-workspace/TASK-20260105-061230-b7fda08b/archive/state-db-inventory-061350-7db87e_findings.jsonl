{"timestamp": "2026-01-05T06:14:52.612060", "agent_id": "state-db-inventory-061350-7db87e", "finding_type": "insight", "severity": "low", "message": "Complete state_db.py function inventory for dashboard migration", "data": {"file": "orchestrator/state_db.py", "total_functions": 52, "categories": {"lifecycle_management": ["update_task_status(workspace_base, task_id, new_status) -> bool", "update_phase_status(workspace_base, task_id, phase_index, new_status) -> bool", "transition_task_to_active(workspace_base, task_id) -> bool", "transition_task_to_completed(workspace_base, task_id) -> bool", "check_task_completion(workspace_base, task_id) -> bool", "mark_agent_terminal(workspace_base, agent_id, status, reason, auto_rollup) -> Dict"], "agent_data_queries": ["get_agents_for_task(workspace_base, task_id) -> List[Dict]", "get_active_agent_count(workspace_base, task_id) -> int", "get_phase_agent_counts(workspace_base, task_id, phase_index) -> Dict[str, int]", "cleanup_stale_agents(workspace_base, task_id, stale_threshold_minutes) -> int"], "task_data_queries": ["get_all_tasks(workspace_base, limit, offset, status_filter) -> List[Dict]", "get_task_by_id_for_dashboard(workspace_base, task_id) -> Optional[Dict]", "load_task_snapshot(workspace_base, task_id) -> Optional[Dict]", "get_task_counts(workspace_base, task_id) -> Dict[str, int]"], "phase_data_queries": ["load_phase_snapshot(workspace_base, task_id, phase_index) -> Dict", "get_latest_handover(workspace_base, task_id, to_phase_index) -> Optional[Dict]", "create_handover(workspace_base, task_id, from_phase_index, to_phase_index, summary, ...) -> int"], "progress_tracking": ["record_progress(workspace_base, task_id, agent_id, timestamp, status, message, progress) -> None", "load_recent_progress_latest(workspace_base, task_id, limit) -> List[Dict]"], "findings_reviews": ["record_agent_finding(workspace_base, task_id, agent_id, finding_type, severity, message, data, phase_index) -> int", "get_agent_findings(workspace_base, task_id, agent_id, finding_type, severity, since, limit) -> List[Dict]", "create_review(workspace_base, task_id, phase_index, review_id) -> bool", "update_review(workspace_base, review_id, status, verdict, reviewer_notes) -> bool"], "global_counts_stats": ["get_active_counts(workspace_base) -> Dict[str, int]", "get_global_counts(workspace_base) -> Dict[str, int]", "get_global_active_counts(workspace_base) -> Dict[str, int]", "get_dashboard_summary(workspace_base, limit) -> Dict[str, Any]"], "database_utilities": ["ensure_db(workspace_base) -> str", "get_state_db_path(workspace_base) -> str", "reconcile_task_workspace(task_workspace) -> Optional[str]", "inspect_database(workspace_base) -> Dict[str, Any]"]}, "recommended_for_dashboard_migration": {"agents_py_replacements": {"list_agents": "get_agents_for_task(workspace_base, task_id)", "get_agent_details": "Use SQL query on agents table via _connect()", "get_agent_counts": "get_phase_agent_counts() or get_task_counts()", "active_agent_check": "get_active_agent_count(workspace_base, task_id)"}, "phases_py_replacements": {"get_phase_data": "load_phase_snapshot(workspace_base, task_id, phase_index)", "get_phase_agents": "SQL query: SELECT * FROM agents WHERE task_id=? AND phase_index=?", "phase_status_check": "SQL query: SELECT status FROM phases WHERE task_id=? AND phase_index=?", "handover_retrieval": "get_latest_handover(workspace_base, task_id, to_phase_index)"}, "tasks_py_already_clean": "tasks.py likely already uses state_db, no migration needed"}, "database_schema": {"tables": ["tasks (task_id PK, workspace, description, status, priority, created_at, updated_at, current_phase_index)", "phases (task_id, phase_index PK, name, description, deliverables, success_criteria, status, created_at, started_at, completed_at)", "agents (agent_id PK, task_id FK, type, model, tmux_session, parent, depth, phase_index, claude_pid, cursor_pid, tracked_files, started_at, completed_at, status, progress, last_update, prompt_preview)", "agent_progress_latest (task_id, agent_id PK, timestamp, status, progress, message)", "reviews (review_id PK, task_id FK, phase_index, status, verdict, created_at, completed_at, reviewer_notes)", "agent_findings (finding_id PK, task_id FK, agent_id FK, phase_index, finding_type, severity, message, data, created_at)", "handovers (handover_id PK, task_id FK, from_phase_index, to_phase_index, summary, key_findings, blockers, recommendations, created_at)"]}, "key_insights": ["orchestrator/state_db.py:1730-1759 - Dashboard wrapper functions already exist (get_all_tasks_for_dashboard, get_task_by_id_for_dashboard, get_agents_for_task)", "orchestrator/state_db.py:1595-1667 - get_dashboard_summary() provides comprehensive overview with global counts, recent tasks, active agents, and status distribution", "orchestrator/state_db.py:959-982 - load_phase_snapshot() returns agents + counts for a phase, perfect for phases.py migration", "orchestrator/state_db.py:1444-1468 - get_phase_agent_counts() returns total/active/completed/failed/pending counts", "orchestrator/state_db.py:1748-1759 - get_agents_for_task() returns all agents for a task (ORDER BY created_at DESC)", "orchestrator/state_db.py:484-538 - get_all_tasks() already supports pagination (limit/offset) and status filtering", "All primary data is already in SQLite - registry JSON reads should only be fallback for legacy compatibility"]}}
